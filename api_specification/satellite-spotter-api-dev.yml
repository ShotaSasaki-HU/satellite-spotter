openapi: 3.0.0
info:
  title: Satellite Spotter API
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: 開発用ローカルサーバー
paths: # エンドポイント
  /api/v1/locations:
    get:
      summary: マップ移動用に検索クエリに対応する場所の代表座標を取得する．
      parameters:
        - name: lat
          in: query
          required: false # 任意
          description: マップにおける視点の緯度（十進法度単位）
          schema:
            $ref: '#/components/schemas/Latitude'
        - name: lon
          in: query
          required: false # 任意
          description: マップにおける視点の経度（十進法度単位）
          schema:
            $ref: '#/components/schemas/Longitude'
        - name: q
          in: query
          required: true
          description: 検索したい場所名
          schema:
            type: string
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: 成功時のレスポンス（0件の場合は空の配列を返す．）
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    description: ヒット件数（ページネーション用）
                    example: 42
                  locations:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: 場所の名称
                          example: "北海道札幌市中央区旭ケ丘一丁目"
                        lat:
                          type: number
                          description: 緯度（十進法度単位）
                          example: 34.391303
                        lon:
                          type: number
                          description: 経度（十進法度単位）
                          example: 132.45211
        '400':
          description: クエリパラメータが不正な場合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: サーバー内部で予期せぬエラーが発生した場合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/recommendations/events:
    get:
      summary: 指定された範囲から，座標群と観測イベント群を取得する．
      parameters:
        - name: lat
          in: query
          required: true # 必須
          description: 探索中心の緯度（十進法度単位）
          schema:
            $ref: '#/components/schemas/Latitude'
        - name: lon
          in: query
          required: true # 必須
          description: 探索中心の経度（十進法度単位）
          schema:
            $ref: '#/components/schemas/Longitude'
        - name: radius
          in: query
          required: true
          description: 探索半径（km）
          schema:
            type: integer
            default: 30
            minimum: 1
            maximum: 125
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: 成功時のレスポンス
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    description: ヒット件数（ページネーション用）
                    example: 42
                  events:
                    type: array
                    items:
                      $ref: '#/components/schemas/EventBase'
        '400': # Bad Request（クライアントのミス）
          description: パラメータが不正な場合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500': # Internal Server Error（サーバーのミス）
          description: サーバー内部で予期せぬエラーが発生した場合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/forecasts/events:
    get:
      summary: 指定された座標から，観測イベント群を取得する．
      parameters:
        - name: lat
          in: query
          required: true # 必須
          description: ユーザの好みの緯度（十進法度単位）
          schema:
            $ref: '#/components/schemas/Latitude'
        - name: lon
          in: query
          required: true # 必須
          description: ユーザの好みの経度（十進法度単位）
          schema:
            $ref: '#/components/schemas/Longitude'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: 成功時のレスポンス
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    description: ヒット件数（ページネーション用）
                    example: 42
                  events:
                    type: array
                    items:
                      $ref: '#/components/schemas/EventBase'
        '400': # Bad Request（クライアントのミス）
          description: パラメータが不正な場合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500': # Internal Server Error（サーバーのミス）
          description: サーバー内部で予期せぬエラーが発生した場合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/trajectories:
    get:
      summary: 特定のイベントの軌道とスコア詳細を取得する．
      parameters:
        - name: start_time
          in: query
          required: true
          description: イベントの開始時刻（ISO 8601）
          schema:
            type: string
            format: date-time
            example: "2025-10-11T19:50:45+09:00"
        - name: lat
          in: query
          required: true # 必須
          description: 観測地点の緯度（十進法度単位）
          schema:
            $ref: '#/components/schemas/Latitude'
        - name: lon
          in: query
          required: true # 必須
          description: 観測地点の経度（十進法度単位）
          schema:
            $ref: '#/components/schemas/Longitude'
        - name: international_designators
          in: query
          required: true
          description: 開始時間と終了時間の決定に必要となる注目している衛星の国際衛星識別符号
          schema:
            type: array
            items:
              type: string
          style: form # URLのクエリ文字列形式で表現
          explode: false # 複数値はカンマ区切り
          example: ["2025-223A", "2025-223B", "2025-223C", "2025-223D", "2025-223E"]
      responses:
        '200':
          description: 成功時のレスポンス
          content:
            application/json:
              schema:
                type: object
                properties:
                  start_time:
                    type: string
                    format: date-time
                    description: イベントの開始時刻（ISO 8601）
                    example: "2025-10-11T19:50:45+09:00"
                  end_time:
                    type: string
                    format: date-time
                    description: イベントの終了時刻（ISO 8601）
                    example: "2025-10-11T19:55:45+09:00"
                  trajectories:
                    type: array
                    items:
                      type: object
                      properties:
                        timestamp:
                          type: string
                          format: date-time
                          example: "2025-10-11T19:50:45+09:00"
                        positions:
                          type: array
                          description: 当該時刻における全衛星の位置リスト
                          items:
                            type: object
                            properties:
                              international_designator:
                                type: string
                                example: "2025-223A"
                                description: 国際衛星識別番号
                              ra:
                                type: number
                                format: float
                                description: 当該衛星の赤経（度）
                              dec:
                                type: number
                                format: float
                                description: 当該衛星の赤緯（度）
                  scores:
                    type: object
                    properties:
                      visibility:
                        type: number
                        description: 最終的な可視性スコア
                        example: 0.8
                        minimum: 0.0
                        maximum: 1.0
                      visible_time_ratio:
                        type: number
                        description: 地形スコア
                        example: 0.8
                        minimum: 0.0
                        maximum: 1.0
                      sky_glow:
                        type: number
                        description: 光害スコア
                        example: 0.8
                        minimum: 0.0
                        maximum: 1.0
                      moon_fract_illumi:
                        type: number
                        description: 月相スコア
                        example: 0.8
                        minimum: 0.0
                        maximum: 1.0
                      rain:
                        type: number
                        description: 雨スコア
                        example: 0.8
                        minimum: 0.0
                        maximum: 1.0
                      cloud:
                        type: number
                        description: 雲量スコア
                        example: 0.8
                        minimum: 0.0
                        maximum: 1.0
                      met_visibility:
                        type: number
                        description: 気象学的な視程スコア
                        example: 0.8
                        minimum: 0.0
                        maximum: 1.0
        '400': # Bad Request（クライアントのミス）
          description: パラメータが不正な場合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500': # Internal Server Error（サーバーのミス）
          description: サーバー内部で予期せぬエラーが発生した場合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  parameters:
    Limit:
      name: limit
      in: query
      required: false
      description: 取得する最大数（ページネーション用）
      schema:
        type: integer
        default: 10
        minimum: 1
        maximum: 100
    Offset:
      name: offset
      in: query
      required: false
      description: 取得を開始する位置（ページネーション用）
      schema:
        type: integer
        default: 0
        minimum: 0
  schemas:
    Latitude:
      type: number
      format: float
      minimum: -90.0
      maximum: 90.0
    Longitude:
      type: number
      format: float
      minimum: -180.0
      maximum: 180.0
    EventBase: # イベントの共通スキーマ
      type: object
      properties:
        location_name:
          type: string
          description: 公園や展望台の名前
          example: "鏡山公園"
        start_time:
          type: string
          format: date-time
          description: イベントの開始時刻（ISO 8601，UTC）
          example: "2025-10-11T19:50:45+00:00"
        end_time:
          type: string
          format: date-time
          description: イベントの終了時刻（ISO 8601，UTC）
          example: "2025-10-11T19:55:45+00:00"
        visibility:
          type: number
          description: 最終的な可視性スコア
          example: 0.8
          minimum: 0.0
          maximum: 1.0
        event_type:
          type: string
          description: 観測対象のタイプ（ISS, Starlink Satellite Train, etc.）
          example: "Starlink Satellite Train"
        lat:
          type: number
          format: float
          description: 緯度（十進法度単位）
        lon:
          type: number
          format: float
          description: 経度（十進法度単位）
        international_designators:
          type: array
          description: 詳細表示の際に衛星を一意に識別するための国際衛星識別符号
          items:
            type: string
          example: ["25225A","25225B","25225C","25225D","25225E","25225F","25225G","25225H","25225J","25225K","25225L","25225M","25225N","25225P","25225Q","25225R","25225S","25225T","25225U","25225V","25225W","25225X","25225Y","25225Z","25225AA","25225AB","25225AC","25225AD"]
    ErrorResponse: # 共通のエラーレスポンスを定義（DRY原則に基づき）
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
      example:
        error:
          code: "INVALID_PARAMETER"
          message: "lat（緯度）は，-90から90の間で指定してください．"
